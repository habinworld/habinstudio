<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í•˜ë¹ˆ ìŠ¤íŠœë””ì˜¤ Â· ê²Œì‹œíŒ ëª©ë¡</title>

  <!-- ===============================
       GLOBAL CONSTANTS + BOARD HELPER
  =============================== -->
  <script>
    window.HABIN_STORAGE_KEY = "habin_posts";
    window.HABIN_LIST_PAGE   = "list.html";
    window.HABIN_POST_PAGE   = "post.html";

    /* ğŸ§· BOARD ë‹¨ì¼ ì§„ì‹¤ */
    window.getBoardFromURL = function () {
      const b = new URLSearchParams(location.search).get("board");
      return (!b || b === "undefined") ? "kr" : b;
    };

    window.CURRENT_BOARD = window.getBoardFromURL();
  </script>

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="list.css">
  <link rel="stylesheet" href="main-grid.css">
</head>

<body class="list-page">

<script src="date-utils.js"></script>
<script src="image-store.js"></script>  

<div class="page-container">

  <h1 class="page-title" id="board-title">ğŸ“š í•œê¸€ ê²Œì‹œíŒ</h1>

  <div class="top-buttons">
    <a id="btn-new-post" class="btn">ê¸€ì“°ê¸°</a>
    <a id="btn-list" class="btn">ëª©ë¡</a>
    <a href="index.html" class="btn">ë©”ì¸</a>
  </div>

  <!-- ===================== TABLE ===================== -->
  <table class="post-table">
    <thead>
      <tr>
        <th class="admin-only">ê´€ë¦¬</th>
        <th style="width:60px;">ë²ˆí˜¸</th>
        <th style="width:120px;">ì‘ì„±ì</th>
        <th>ì œëª©</th>
        <th style="width:150px;">ë‚ ì§œ</th>
      </tr>
    </thead>
    <tbody id="post-list"></tbody>
  </table>

  <div id="pagination" class="pagination"></div>

  <!-- ===================== GRID ===================== -->
  <div class="grid-floor">
    <div id="current-exhibit" class="main-grid"></div>
  </div>

</div>

<script src="main-grid.js"></script>
<script src="admin-actions.js"></script>
<script>
/* ======================================================
   ğŸ” ADMIN MODE / ê´€ë¦¬ìëª¨ë“œ ì•„ë˜ 2ì¤„ë¡œ ì˜¨ì˜¤í”„
======================================================== */
//window.IS_ADMIN = localStorage.getItem("habin_admin") === "true";//
//document.body.classList.toggle("is-admin", window.IS_ADMIN);//
  
  /*----- ì œëª© ì„¸íŒ…------ */
    (function () {
     const board = window.CURRENT_BOARD;
    
      const titleMap = {
    kr: "ğŸ“š í•œê¸€ ê²Œì‹œíŒ",
    en: "ğŸŒ English Board",
    forge: "ğŸ”¥âš’ï¸ ëŒ€ì¥ê°„",
    qna: "â“ ì§ˆë¬¸ì˜ ê³µê°„",
    gallery: "ğŸ–¼ï¸ ê°¤ëŸ¬ë¦¬",
    video: "â–¶ï¸ ë™ì˜ìƒ",
    studio: "âœ¨ Studio",
    etc: "ğŸ¢ğŸš€ ê¸°íƒ€"
  };

  const titleEl = document.getElementById("board-title");
  if (titleEl && titleMap[board]) {
    titleEl.textContent = titleMap[board];
  }
})(); 
      
  /* ===============================
   ğŸ”— TOP LINKS
=============================== */
document.getElementById("btn-new-post").href =
  "post.html?mode=new&board=" + CURRENT_BOARD;
const btnList =document.getElementById("btn-list");
 if (btnList) {btnList.href= "list.html?board=" + CURRENT_BOARD;}

/* ===============================
   ğŸ“¦ LOAD DATA
=============================== */
const allPosts = JSON.parse(localStorage.getItem("habin_posts") || "[]");
const posts = allPosts.filter(p => (p.board || "kr") === CURRENT_BOARD);
// ğŸ”¥ ìµœì‹  ê¸€ì´ ìœ„ë¡œ ì˜¤ë„ë¡ ìˆœì„œ ë’¤ì§‘ê¸° (ê²Œì‹œíŒ ê¸°ë³¸ ê·œì¹™)
posts.reverse();  
window.posts = posts; // ê´€ë¦¬ì ì•¡ì…˜ìš©

/* ===============================
   ğŸ”§ HELPERS
=============================== */
function saveAllPosts() {
  localStorage.setItem("habin_posts", JSON.stringify(allPosts));
}
function findIndexById(id) {
  return allPosts.findIndex(p => p.id === id);
}

/* ===============================
   ğŸ“„ PAGINATION
=============================== */
const itemsPerPage = 8;
let currentPage = Number(new URLSearchParams(location.search).get("page")) || 1;

function getCurrentPagePosts() {
  const start = (currentPage - 1) * itemsPerPage;
  return posts.slice(start, start + itemsPerPage);
}

/* ===============================
   ğŸ§¾ RENDER LIST
=============================== */
function renderList() {
  const tbody = document.getElementById("post-list");
  tbody.innerHTML = "";

  const pagePosts = getCurrentPagePosts();
  if (!pagePosts.length) {
    tbody.innerHTML =
      `<tr><td colspan="5" class="empty">ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
    return;
  }

  pagePosts.forEach((p, idx) => {
    const realIndex = (currentPage - 1) * itemsPerPage + idx;
    const tr = document.createElement("tr");
 
tr.innerHTML = `
<td class="admin-only admin-actions" style="text-align:center; white-space:nowrap;">
  <!------------ ğŸ“¦ ê²Œì‹œíŒ ì´ë™--------- -->
  <select onchange="moveBoard(${realIndex}, this.value)">
    <option value="">ì´ë™</option>
    <option value="kr">í•œê¸€</option>
    <option value="en">English</option>
    <option value="forge">ëŒ€ì¥ê°„</option>
    <option value="studio">Studio</option>
    <option value="etc">ê¸°íƒ€</option>
  </select>
   <!-- ğŸ“Œ ê³µì§€ -->
  <button title="ê³µì§€"
          onclick="toggleNotice(${realIndex})">ğŸ“Œ</button>
  <!-- â–² ìœ„ -->
  <button title="ìœ„ë¡œ ì´ë™"
          onclick="moveUp(${realIndex})">â–²</button>
  <!-- â–¼ ì•„ë˜ -->
  <button title="ì•„ë˜ë¡œ ì´ë™"
          onclick="moveDown(${realIndex})">â–¼</button>
  <!-- ğŸ—‘ ì‚­ì œ -->
  <button title="ì‚­ì œ"
          class="btn-del"
          onclick="deletePost(${realIndex})">DEL</button>
</td>
<!---------ë¦¬ìŠ¤íŠ¸ë°°ì—´  âœ… ë²ˆí˜¸/ì‘ì„±ì/ì œëª©/ë‚ ì§œ --------------->
  <!-- ğŸ”¥ ë²ˆí˜¸ ê³„ì‚° (ë‚´ë¦¼ì°¨ìˆœ) -->
<td>${posts.length - ((currentPage - 1) * itemsPerPage + idx)}</td>
<td>${p.writer || "í•˜ë¹ˆ"}</td>
<td>
  <a class="title-link"
     href="post.html?mode=view&id=${p.id}&board=${getBoardFromURL()}">
     ${p.isNotice ? "ğŸ“Œ " : ""}${p.title}
  </a>
</td>
<td>${formatDate(p.date)}</td>
`;

    if (p.isNotice) tr.classList.add("notice-row");
    tbody.appendChild(tr);
  });
}

/* ===============================
   ğŸ” PAGINATION UI
=============================== */
function renderPagination() {
  const pag = document.getElementById("pagination");
  pag.innerHTML = "";

  const totalPages = Math.ceil(posts.length / itemsPerPage);
  if (totalPages <= 1) return;

  if (currentPage > 1) {
    pag.innerHTML += `<a href="?board=${CURRENT_BOARD}&page=${currentPage - 1}" class="page-btn">ì´ì „</a>`;
  }

  for (let i = 1; i <= totalPages; i++) {
  pag.innerHTML +=
    `<a href="?board=${CURRENT_BOARD}&page=${i}"
      class="${i === currentPage ? "active" : ""}">${i}</a>`;
  }

  if (currentPage < totalPages) {
  pag.innerHTML +=
    `<a href="?board=${CURRENT_BOARD}&page=${currentPage + 1}" class="page-btn">ë‹¤ìŒ</a>`;
}
}

/* ===============================
   ğŸ§± GRID
=============================== */
function renderGrid() {
  if (typeof renderMainGrid === "function") {
        renderMainGrid(getCurrentPagePosts());
}
}
/* ===============================
   ğŸ” BOARD MOVE (ADMIN)
=============================== */
function moveBoard(i, targetBoard) {
  if (!targetBoard) return;
  const postId = posts[i].id;
  const idx = findIndexById(postId);
  if (idx === -1) return;

  allPosts[idx].board = targetBoard;
  saveAllPosts();
  location.reload();
}

/* ===============================
   ğŸš€ INIT
=============================== */
renderList();
renderPagination();
renderGrid();

</script>

</body>
</html>













































































































  
 
  



