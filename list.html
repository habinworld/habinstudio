<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í•˜ë¹ˆ ìŠ¤íŠœë””ì˜¤ Â· ê²Œì‹œíŒ ëª©ë¡</title>

  <!-- ê³µí†µ ìŠ¤íƒ€ì¼ -->
  <link rel="stylesheet" href="style.css">

  <!-- âœ… ì¹´ë“œë·°(ê·¸ë¦¬ë“œ) ìŠ¤íƒ€ì¼ -->
  <link rel="stylesheet" href="main-grid.css">
  <link rel="stylesheet" href="list.css"> 
 
</head>

<body class="list-page">

  <!-- ë‚ ì§œ ìœ í‹¸ -->
  <script src="date-utils.js"></script>

  <div class="page-container">
    <h1 class="page-title">ğŸ“š í•œê¸€ ê²Œì‹œíŒ</h1>

    <div class="top-buttons">
      <a href="post.html?mode=new" class="btn">ê¸€ì“°ê¸°</a>
      <a href="list.html" class="btn">ëª©ë¡</a>
      <a href="index.html" class="btn">ë©”ì¸</a>
    </div>

    <!-- ===================== í…Œì´ë¸” ===================== -->
    <table class="post-table">
      <thead>
        <tr>
          <th class="admin-only" style="width:120px;">ê´€ë¦¬</th> <!-- âœ… ë§¨ ì• -->
          <th style="width:60px;">ë²ˆí˜¸</th>
          <th style="width:120px;">ì‘ì„±ì</th>
          <th>ì œëª©</th>
          <th style="width:150px;">ë‚ ì§œ</th>
        </tr>
      </thead>
      <tbody id="post-list"></tbody>
    </table>

    <!-- ===================== í˜ì´ì§€ë„¤ì´ì…˜ ===================== -->
    <div id="pagination" class="pagination"></div>

    <!-- ===================== ì¹´ë“œë·°(ê·¸ë¦¬ë“œ) ===================== -->
    <div class="grid-floor">
      <div id="current-exhibit" class="main-grid"></div>
    </div>
  </div>

  <!-- ì¹´ë“œë·° ì—”ì§„ -->
  <script src="main-grid.js"></script>

  <script>
    /* ğŸ” ê´€ë¦¬ì ìƒíƒœ ì½ê¸° (ë¦¬ìŠ¤íŠ¸ ì „ìš©) */
     window.IS_ADMIN = localStorage.getItem("habin_admin") === "true";
    document.body.classList.toggle("is-admin", window.IS_ADMIN);
    /* ğŸ—‚ localStorageì—ì„œ ê¸€ ëª©ë¡ ë¡œë“œ */
    let posts = JSON.parse(localStorage.getItem("habin_posts") || "[]");
         const itemsPerPage = 8;
    let currentPage = new URLSearchParams(window.location.search).get("page") || 1;
    currentPage = parseInt(currentPage, 8);
    if (!currentPage || currentPage < 1) currentPage = 1;

    /* ğŸ“Œ í˜„ì¬ í˜ì´ì§€ ê¸€ ì¶”ì¶œ (ë‹¨ì¼ ì§„ì‹¤) */
    function getCurrentPagePosts() {
      const start = (currentPage - 1) * itemsPerPage;
      return posts.slice(start, start + itemsPerPage);
    }

    /* ğŸ“Œ í…Œì´ë¸” ë Œë” */
    function renderList() {
      const pagePosts = getCurrentPagePosts();
      const tbody = document.getElementById("post-list");
      tbody.innerHTML = "";

      if (pagePosts.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5" class="empty">ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
        return;
      }

      pagePosts.forEach((p, idx) => {
        const tr = document.createElement("tr");
      const realIndex = (currentPage - 1) * itemsPerPage + idx;
        tr.innerHTML = `
         <!-- âœ… ê´€ë¦¬ì ì—´ (ë²ˆí˜¸ ì™¼ìª½) -->
<td class="admin-only admin-actions" style="text-align:center; white-space:nowrap;">
  <button title="ê³µì§€"
          onclick="toggleNotice(${idx})">ğŸ“Œ</button>

  <button title="ìœ„ë¡œ ì´ë™"
          onclick="moveUp(${realIndex})">â–²</button>

  <button title="ì•„ë˜ë¡œ ì´ë™"
          onclick="moveDown(${realIndex})">â–¼</button>

  <button title="ì‚­ì œ"
          class="btn-del"
          onclick="deletePost(${realIndex})">DEL</button>
</td>
          <!-- âœ…ë¦¬ìŠ¤íŠ¸ ë°°ì—´....ë²ˆí˜¸/ì‘ì„±ì/ì œëª©/ë‚ ì§œ -->
          <td>${posts.length - ((currentPage - 1) * itemsPerPage + idx)}</td>
          <td>${p.writer || "í•˜ë¹ˆ"}</td>
          <td>
            <a href="post.html?mode=view&id=${p.id}" class="title-link">
              ${p.isNotice ? "ğŸ“Œ " : ""}${p.title}
            </a>
          </td>
          <td>${formatDate(p.date)}</td>
        `;

        if (p.isNotice) tr.classList.add("notice-row");
        tbody.appendChild(tr);
      });
    }
      
    /* ğŸ“Œ í˜ì´ì§€ë„¤ì´ì…˜ */
    function renderPagination() {
      const totalPages = Math.ceil(posts.length / itemsPerPage);
      const pag = document.getElementById("pagination");
      pag.innerHTML = "";

      if (totalPages <= 1) return;

      if (currentPage > 1) {
        pag.innerHTML += `<a href="?page=${currentPage - 1}" class="page-btn">ì´ì „</a>`;
      }

      for (let i = 1; i <= totalPages; i++) {
        pag.innerHTML += `<a href="?page=${i}" class="page-btn ${i === currentPage ? "active" : ""}">${i}</a>`;
      }

      if (currentPage < totalPages) {
        pag.innerHTML += `<a href="?page=${currentPage + 1}" class="page-btn">ë‹¤ìŒ</a>`;
      }
    }

    /* ğŸ“Œ ì¹´ë“œë·° ë Œë” (íŒë‹¨ì€ ë¦¬ìŠ¤íŠ¸, ì¶œë ¥ë§Œ ê·¸ë¦¬ë“œ) */
    function renderGrid() {
      if (typeof renderMainGrid === "function") {
        renderMainGrid(getCurrentPagePosts());
      }
    }

    renderList();
    renderPagination();
    renderGrid();
    
/* ===============================
   ğŸ“Œ ê³µì§€ ì˜ì—­ ê²½ê³„ ê³„ì‚° (ì—¬ê¸°ì—!)
================================ */
function getNoticeEndIndex() {
  return posts.findLastIndex(p => p.isNotice);
}
   /*----ê¸€ ìœ„ë˜ ì´ë™  â–² â–¼ ----*/
   function moveUp(i) {
   const noticeEnd = getNoticeEndIndex();

// ê³µì§€: ê³µì§€ ì˜ì—­ ë§¨ ìœ„ë©´ ë¶ˆê°€
if (posts[i].isNotice && i === 0) return;

// ì¼ë°˜ê¸€: ê³µì§€ ì˜ì—­ ë°”ë¡œ ì•„ë˜ë©´ ë¶ˆê°€
if (!posts[i].isNotice && i === noticeEnd + 1) return;
     
  if (i <= 0) return;

  [posts[i], posts[i - 1]] = [posts[i - 1], posts[i]];
  localStorage.setItem("habin_posts", JSON.stringify(posts));
  location.reload();
}

function moveDown(i) {
const noticeEnd = getNoticeEndIndex();

// ê³µì§€: ê³µì§€ ì˜ì—­ ë§¨ ì•„ë˜ë©´ ë¶ˆê°€
if (posts[i].isNotice && i === noticeEnd) return;

// ì¼ë°˜ê¸€: ë§¨ ë§ˆì§€ë§‰ì´ë©´ ë¶ˆê°€
if (!posts[i].isNotice && i === posts.length - 1) return;
  
  if (i >= posts.length - 1) return;

  [posts[i], posts[i + 1]] = [posts[i + 1], posts[i]];
  localStorage.setItem("habin_posts", JSON.stringify(posts));
  location.reload();
}
  </script>

</body>
</html>

  



