<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>í•˜ë¹ˆ ìŠ¤íŠœë””ì˜¤ Â· ê²Œì‹œíŒ ëª©ë¡</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<!-- ğŸ” ë¹„ë°€ì˜ ë¬¸ -->
<script src="secret-gate.js"></script>

<div class="page-container">

  <h1 class="page-title">ğŸ“š í•œê¸€ ê²Œì‹œíŒ</h1>

  <div class="top-actions">
    <a href="editor.html" class="write-btn">âœ ê¸€ì“°ê¸°</a>
  </div>

  <table class="post-table">
    <thead>
      <tr>
        <th style="width:50px;">ë²ˆí˜¸</th>
        <th>ì œëª©</th>
        <th style="width:120px;">ì‘ì„±ì</th>
        <th style="width:150px;">ë‚ ì§œ</th>
      </tr>
    </thead>
    <tbody id="post-list">
      <!-- JSê°€ ìë™ ì¶œë ¥ -->
    </tbody>
  </table>

  <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
  <div id="pagination" class="pagination"></div>

</div>

<script>
/* ---------------------------------------------------
   ğŸ“Œ localStorageì—ì„œ ê¸€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
--------------------------------------------------- */
let posts = JSON.parse(localStorage.getItem("habin_posts") || "[]");

/* ---------------------------------------------------
   ğŸ”” ê³µì§€ + ì¼ë°˜ê¸€ ë¶„ë¦¬ í›„ ì •ë ¬ (ìµœì‹ ìˆœ)
--------------------------------------------------- */
const noticePosts = posts
  .filter(p => p.isNotice)
  .sort((a, b) => new Date(b.date) - new Date(a.date));

const normalPosts = posts
  .filter(p => !p.isNotice)
  .sort((a, b) => new Date(b.date) - new Date(a.date));

/* ê³µì§€ ë¨¼ì € + ì¼ë°˜ê¸€ ë’¤ */
posts = [...noticePosts, ...normalPosts];

const itemsPerPage = 10;
const urlParams = new URLSearchParams(window.location.search);
let currentPage = parseInt(urlParams.get("page")) || 1;

/* ---------------------------------------------------
   ğŸ“Œ ëª©ë¡ ì¶œë ¥ í•¨ìˆ˜
--------------------------------------------------- */
function renderList() {
  const start = (currentPage - 1) * itemsPerPage;
  const end = start + itemsPerPage;
  const pagePosts = posts.slice(start, end);

  const tbody = document.getElementById("post-list");
  tbody.innerHTML = "";

  if (pagePosts.length === 0) {
    tbody.innerHTML = `<tr><td colspan="4" class="empty">ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
    return;
  }

  pagePosts.forEach((p, idx) => {
    const isNotice = p.isNotice ? "ğŸ“Œ " : "";
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${posts.length - (start + idx)}</td>
      <td><a href="view.html?id=${p.id}" class="title-link">${isNotice}${p.title}</a></td>
      <td>${p.writer}</td>
      <td>${p.date}</td>
    `;

    /* ğŸ”” ê³µì§€ê¸€ ê°•ì¡° */
    if (p.isNotice) {
      tr.style.background = "#FFF6D9"; /* ì—°ë…¸ë‘ ë°°ê²½ */
    }

    tbody.appendChild(tr);
  });
}

/* ---------------------------------------------------
   ğŸ“Œ í˜ì´ì§€ë„¤ì´ì…˜ ì¶œë ¥
--------------------------------------------------- */
function renderPagination() {
  const totalPages = Math.ceil(posts.length / itemsPerPage);
  const pag = document.getElementById("pagination");
  pag.innerHTML = "";

  if (totalPages <= 1) return;

  if (currentPage > 1) {
    pag.innerHTML += `<a href="?page=${currentPage - 1}" class="page-btn">ì´ì „</a>`;
  }

  for (let i = 1; i <= totalPages; i++) {
    pag.innerHTML += `<a href="?page=${i}" class="page-btn ${i === currentPage ? "active" : ""}">${i}</a>`;
  }

  if (currentPage < totalPages) {
    pag.innerHTML += `<a href="?page=${currentPage + 1}" class="page-btn">ë‹¤ìŒ</a>`;
  }
}

renderList();
renderPagination();
</script>

</body>
</html>

