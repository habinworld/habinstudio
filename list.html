<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í•˜ë¹ˆ ìŠ¤íŠœë””ì˜¤ Â· ê²Œì‹œíŒ ëª©ë¡</title>
  <script>
  window.HABIN_STORAGE_KEY = "habin_posts"; 
  window.HABIN_LIST_PAGE = "list.html";
  window.HABIN_POST_PAGE = "post.html";
</script>
  <!-- ê³µí†µ ìŠ¤íƒ€ì¼ -->
  <link rel="stylesheet" href="style.css">

  <!-- âœ… ì¹´ë“œë·°(ê·¸ë¦¬ë“œ) ìŠ¤íƒ€ì¼ -->
  <link rel="stylesheet" href="main-grid.css">
  <link rel="stylesheet" href="list.css"> 
 
</head>

<body class="list-page">

  <!-- ë‚ ì§œ ìœ í‹¸ -->
  <script src="date-utils.js"></script>

  <div class="page-container">
    <h1 class="page-title" id="board-title">ğŸ“š í•œê¸€ ê²Œì‹œíŒ</h1>

    <div class="top-buttons">
     <a id="btn-new-post" class="btn">ê¸€ì“°ê¸°</a>
      <a id="btn-list" class="btn">ëª©ë¡</a>
      <a href="index.html" class="btn">ë©”ì¸</a>
    </div>

    <!-- ===================== í…Œì´ë¸” ===================== -->
    <table class="post-table">
      <thead>
        <tr>
          <th class="admin-only" style="width:120px;">ê´€ë¦¬</th> <!-- âœ… ë§¨ ì• -->
          <th style="width:60px;">ë²ˆí˜¸</th>
          <th style="width:120px;">ì‘ì„±ì</th>
          <th>ì œëª©</th>
          <th style="width:150px;">ë‚ ì§œ</th>
        </tr>
      </thead>
      <tbody id="post-list"></tbody>
    </table>

    <!-- ===================== í˜ì´ì§€ë„¤ì´ì…˜ ===================== -->
    <div id="pagination" class="pagination"></div>

    <!-- ===================== ì¹´ë“œë·°(ê·¸ë¦¬ë“œ) ===================== -->
    <div class="grid-floor">
      <div id="current-exhibit" class="main-grid"></div>
    </div>
  </div>

  <!-- ì¹´ë“œë·° ì—”ì§„ -->
  <script src="main-grid.js"></script>
  
  <script>
(function () {
  const board =
    new URLSearchParams(location.search).get("board") || "kr";

  const titleMap = {
    kr: "ğŸ“š í•œê¸€ ê²Œì‹œíŒ",
    en: "ğŸŒ English Board",
    forge: "ğŸ”¥âš’ï¸ ëŒ€ì¥ê°„",
    qna: "â“ ì§ˆë¬¸ì˜ ê³µê°„",
    gallery: "ğŸ–¼ï¸ ê°¤ëŸ¬ë¦¬",
    video: "â–¶ï¸ ë™ì˜ìƒ",
    notice: "ğŸ“¢ ê³µì§€ì‚¬í•­",
    etc: "ğŸ¢ğŸš€ ê¸°íƒ€"
  };

  const titleEl = document.getElementById("board-title");
  if (titleEl && titleMap[board]) {
    titleEl.textContent = titleMap[board];
  }
})();
</script>
  <script>
    /* ğŸ” ê´€ë¦¬ì ìƒíƒœ ì½ê¸° (ë¦¬ìŠ¤íŠ¸ ì „ìš©) ---ì•„ë˜ 2ì¤„ë¡œ ì¤‘ë‹¨, ì‹œì‘ì²˜ë¦¬ */
   // window.IS_ADMIN = localStorage.getItem("habin_admin") === "true";  // 
   // document.body.classList.toggle("is-admin", window.IS_ADMIN);       //

/* ğŸ§· ë³´ë“œ ê²°ì • (URL â†’ ê¸°ë³¸ê°’) */
  window.CURRENT_BOARD =
  new URLSearchParams(location.search).get("board") || "kr";

/* ğŸ§· PINSET â€” ê³µìš© ê¸€ì“°ê¸° ë§í¬ ë³´ì • (10ê°œ ê²Œì‹œíŒ ê³µí†µ) */
document.getElementById("btn-new-post").setAttribute(
  "href",
  "post.html?mode=new&board=" + window.CURRENT_BOARD
);
  
/* ğŸ§· PINSET â€” ëª©ë¡ ë§í¬ board ìœ ì§€ (ê³µìš©) */
const btnList = document.getElementById("btn-list");
if (btnList) {
  btnList.href =
    "list.html?board=" + window.CURRENT_BOARD;
}
   
/* ğŸ—‚ localStorageì—ì„œ ê¸€ ëª©ë¡ ë¡œë“œ (ì „ì²´) */
const allPosts = JSON.parse(localStorage.getItem("habin_posts") || "[]");

/* ğŸ—‚ í˜„ì¬ ë³´ë“œ ê¸€ë§Œ ì¶”ì¶œ (ì•ˆì „ í•„í„°) */
const posts = allPosts.filter(p => (p.board || "kr") === CURRENT_BOARD);

const itemsPerPage = 8;
let currentPage = new URLSearchParams(window.location.search).get("page") || 1;

    /* ğŸ“Œ í˜„ì¬ í˜ì´ì§€ ê¸€ ì¶”ì¶œ (ë‹¨ì¼ ì§„ì‹¤) */
    function getCurrentPagePosts() {
      const start = (currentPage - 1) * itemsPerPage;
      return posts.slice(start, start + itemsPerPage);
    }

    /* ğŸ“Œ í…Œì´ë¸” ë Œë” */
    function renderList() {
      const pagePosts = getCurrentPagePosts();
      const tbody = document.getElementById("post-list");
      tbody.innerHTML = "";

      if (pagePosts.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5" class="empty">ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
        return;
      }

      pagePosts.forEach((p, idx) => {
        const tr = document.createElement("tr");
      const realIndex = (currentPage - 1) * itemsPerPage + idx;
        tr.innerHTML = `
         <!-- âœ… ê´€ë¦¬ì ì—´ (ë²ˆí˜¸ ì™¼ìª½) -->
<td class="admin-only admin-actions" style="text-align:center; white-space:nowrap;">
  <button title="ê³µì§€"
          onclick="toggleNotice(${realIndex})">ğŸ“Œ</button>

  <button title="ìœ„ë¡œ ì´ë™"
          onclick="moveUp(${realIndex})">â–²</button>

  <button title="ì•„ë˜ë¡œ ì´ë™"
          onclick="moveDown(${realIndex})">â–¼</button>

  <button title="ì‚­ì œ"
          class="btn-del"
          onclick="deletePost(${realIndex})">DEL</button>
</td>
          <!-- âœ…ë¦¬ìŠ¤íŠ¸ ë°°ì—´....ë²ˆí˜¸/ì‘ì„±ì/ì œëª©/ë‚ ì§œ -->
          <td>${posts.length - ((currentPage - 1) * itemsPerPage + idx)}</td>
          <td>${p.writer || "í•˜ë¹ˆ"}</td>
          <td>
            <a href="post.html?mode=view&id=${p.id}&board=${window.CURRENT_BOARD}"
              class="title-link">
              ${p.isNotice ? "ğŸ“Œ " : ""}${p.title}
            </a>
          </td>
          <td>${formatDate(p.date)}</td>
        `;

        if (p.isNotice) tr.classList.add("notice-row");
        tbody.appendChild(tr);
      });
    }
   /* ğŸ“Œ í˜ì´ì§€ë„¤ì´ì…˜ */   
    function renderPagination() {
  const totalPages = Math.ceil(posts.length / itemsPerPage);
  const pag = document.getElementById("pagination");
  pag.innerHTML = "";

  if (totalPages <= 1) return;

  if (currentPage > 1) {
    pag.innerHTML += `<a href="?board=${CURRENT_BOARD}&page=${currentPage - 1}" class="page-btn">ì´ì „</a>`;
  }

  for (let i = 1; i <= totalPages; i++) {
    pag.innerHTML += `<a href="?board=${CURRENT_BOARD}&page=${i}" class="page-btn ${i === currentPage ? "active" : ""}">${i}</a>`;
  }

  if (currentPage < totalPages) {
    pag.innerHTML += `<a href="?board=${CURRENT_BOARD}&page=${currentPage + 1}" class="page-btn">ë‹¤ìŒ</a>`;
  }
}

    /* ğŸ“Œ ì¹´ë“œë·° ë Œë” (íŒë‹¨ì€ ë¦¬ìŠ¤íŠ¸, ì¶œë ¥ë§Œ ê·¸ë¦¬ë“œ) */
    function renderGrid() {
      if (typeof renderMainGrid === "function") {
        renderMainGrid(getCurrentPagePosts());
      }
    }

    renderList();
    renderPagination();
    renderGrid();
    
/* ===============================
   ğŸ“Œ ê³µì§€ ì˜ì—­ ê²½ê³„ ê³„ì‚° (ì—¬ê¸°ì—!)
================================ */
function getNoticeEndIndex() {
  return posts.findLastIndex(p => p.isNotice);
}
   /*----ê¸€ ìœ„ë˜ ì´ë™  â–² â–¼ ----*/
   function moveUp(i) {
   const noticeEnd = getNoticeEndIndex();

// ê³µì§€: ê³µì§€ ì˜ì—­ ë§¨ ìœ„ë©´ ë¶ˆê°€
if (posts[i].isNotice && i === 0) return;

// ì¼ë°˜ê¸€: ê³µì§€ ì˜ì—­ ë°”ë¡œ ì•„ë˜ë©´ ë¶ˆê°€
if (!posts[i].isNotice && i === noticeEnd + 1) return;
   
   [posts[i], posts[i - 1]] = [posts[i - 1], posts[i]];
   localStorage.setItem("habin_posts", JSON.stringify(posts));
   location.reload();
}

function moveDown(i) {
const noticeEnd = getNoticeEndIndex();

// ê³µì§€: ê³µì§€ ì˜ì—­ ë§¨ ì•„ë˜ë©´ ë¶ˆê°€
if (posts[i].isNotice && i === noticeEnd) return;

// ì¼ë°˜ê¸€: ë§¨ ë§ˆì§€ë§‰ì´ë©´ ë¶ˆê°€
if (!posts[i].isNotice && i === posts.length - 1) return;
    
  [posts[i], posts[i + 1]] = [posts[i + 1], posts[i]];
  localStorage.setItem("habin_posts", JSON.stringify(posts));
  location.reload();
}
 /*----ê³µì§€ í† ê¸€ (realIndex ê¸°ì¤€)----*/
function toggleNotice(i) {
  posts[i].isNotice = !posts[i].isNotice;
  localStorage.setItem("habin_posts", JSON.stringify(posts));
  location.reload();  
  }
  /* ===============================
     ğŸ“Œ board ìœ ì§€ ë§í¬ ìë™ ë³´ì • (ì¶”ê°€)
  =============================== */
  (function () {
    const board =
      new URLSearchParams(location.search).get("board") || "kr";

    document.querySelectorAll("[data-board-link]").forEach(el => {
      el.href = el.dataset.boardLink + "?board=" + board;
    });
  })();
  
  </script>

</body>
</html>

  



